function MakeMenu(){		var menuDoc=document;	var menuBody=$("#sidebar");	var menuDiv=$("#page",menuBody);		if(menuDiv.length==0)	{		//menuDiv=$("<div class='toggleCollapse'><h2>��˵�</h2><div>����</div></div><div class='toggleCollapse'><input id='option_key' type='text' value='' /><input id='option_search' type='button' value='' /></div>   <div class='accordion' fillSpace='sidebar' id='page'></div>");		menuDiv=$("<div class='toggleCollapse'><h2>��˵�</h2><div>����</div></div><div class='accordion' fillSpace='sidebar' id='page'></div>");		$(menuBody).append(menuDiv);	}}function AddMenu(selfMenuID,selfMenuText,selfMenusrc,parentMenuID,pageType){		var menuDoc=document;	var menuBody=$("#sidebar");		var menuPad=$("#page",menuBody);	if(menuPad.length==0)	{		MakeMenu();		menuPad=$("#page",menuBody);	}		var strInnerMenu; 	var parentMenu=$("\"#menu_"+parentMenuID+"\"",menuBody);	if(parentMenu.length==0)  	{    		strInnerMenu="<div class='accordionHeader'><h2><span>Folder</span>"+selfMenuText+"</h2></div>";				strInnerMenu+="<div class='accordionContent' id='menu_"+selfMenuID+"'></div>";				//strInnerMenu="<div class='menu-box' id='menu_"+selfMenuID+"'><h3 class='coolMenu-bar'><span>"+selfMenuText+"</span><button class='menu-close'>-</button></h3></div>";		menuPad.append(strInnerMenu);			}	else if(parentMenu.attr("class")=="accordionContent")  	{				var last = selfMenusrc.split("/");		if(pageType=='D' && selfMenuID=="main" )			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='"+selfMenuID+"' >"+selfMenuText+"</a></li>";		else if( pageType=='D' && selfMenuID!="main")			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' >"+selfMenuText+"</a></li>";/*<a class='addFav' onclick='fav.option.addFav(this)' title='����ղ�'></a>*/		else if(pageType!='D' && selfMenuID=="main")			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='"+selfMenuID+"' external='true' >"+selfMenuText+"</a></li>";		else			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' external='true' >"+selfMenuText+"</a></li>";/*<a class='addFav' onclick='fav.option.addFav(this);' title='����ղ�'></a>*/		if(last[last.length-1] == "..."){			strInnerMenu="<li id='menu_"+selfMenuID+"'><a rel='external_"+selfMenuID+"'>"+selfMenuText+"</a></li>";		}				//strInnerMenu="<li id='menu_"+selfMenuID+"'><span><a href='"+selfMenusrc+"' target='"+srcTarget+"'>"+selfMenuText+"</a></span></li>";		var S_ul=$("\"#ul_"+parentMenuID+"\"",menuBody);		if(S_ul.length==0)		{						S_ul=$("<ul class='tree treeFolder' id='ul_"+parentMenuID+"'></ul>");						//S_ul=$("<ul class='group' id='ul_"+parentMenuID+"'></ul>");			parentMenu.append(S_ul);			}		S_ul.append(strInnerMenu);	}	else  	{				if(pageType=='D')			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' >"+selfMenuText+"</a></li>";/*<a class='addFav' onclick='fav.option.addFav(this)' title='����ղ�'></a>*/		else			strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' external='true'>"+selfMenuText+"</a></li>";/*<a class='addFav' onclick='fav.option.addFav(this)' title='����ղ�'></a>*/				//strInnerMenu="<li id='menu_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='"+srcTarget+"'>"+selfMenuText+"</a></li>";		var T_ul=$("\"#ul_"+parentMenuID+"\"",menuBody);		if(T_ul.length==0)		{			T_ul=$("<ul id='ul_"+parentMenuID+"'></ul>");			parentMenu.append(T_ul);				//parentMenu.addClass("fold-close");			//parentMenu.find("span:first").attr("id","T_span");		}		T_ul.append(strInnerMenu);	}}function addFav(selfMenuID,selfMenuText,selfMenusrc,pageType){	var $first = $("#page .accordionHeader").eq(0);	var strHtml = "",li="";	var $fav = $("#menu_FAV");	if($fav.length == 0){		strHtml += "<div class='accordionHeader'><h2><span>Folder</span>�ղؼ�</h2></div><div class='accordionContent' id='menu_FAV'>";		strHtml += "<ul id='ul_FAV' class='tree treeFolder'></ul></div>";	}	if(selfMenuID){		if(pageType=='D')			li="<li id='menuFav_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' >"+selfMenuText+"</a><a class='deleteFav' onclick='fav.option.deleteFav(this)' title='ȥ����ղ�'></a></li>";		else			li="<li id='menuFav_"+selfMenuID+"'><a href='"+selfMenusrc+"' target='navTab' rel='external_"+selfMenuID+"' external='true'>"+selfMenuText+"</a><a class='deleteFav' onclick='fav.option.deleteFav(this)' title='ȥ����ղ�'></a></li>";	}	$first.before(strHtml);	if(li!="")$("#ul_FAV").append(li);}//var fav = {};//fav.option = {	//addFav:function(o){		//alert(o.parentNode.parentNode.getAttribute("id"));	//},		//deleteFav:function(o){		//alert(o.parentNode.parentNode.getAttribute("id"));	//}//};var getID = function( id ){	return document.getElementById(id);	};var Menu = {};Menu.menuDate = {		isEmptyObject:function(jsonList){		for( var name in jsonList ){			return false;		}		return true;	},			haveNode:function(json,nodeName){		if( json[nodeName] === undefined ){			return false;		}		return true;	},			getFirstNode:function( json ){		var firstNode = new Array;		for( var name in json ){			firstNode.push(name);		}		return firstNode;	},			getList:function(json,nodeName){		return json[nodeName];	},		getNode:function(list,flag){		var v = new Array;		for( var i=0,len=list.length;i<len;i++ ){			if( parseInt(list[i][flag])===1 ){				v.push(list[i]);				}		}		return v;	},		getNodeNameList:function(list,nodeName){		var n = new Array;		for( var i=0,len=list.length;i<len;i++ ){			n.push(list[i][nodeName]);		}		return n;	},		requireList:function(list,headArr){		var len = list.length,			arr = new Array(),			key = new Array(),			nList = new Array(),			index,h=1,id,reg;		while( h ){			for( var i=0;i<len;i++ ){				id = list[i]["ParentID"].trim();				reg = new RegExp("(\\b"+id.toLowerCase()+")\\b");				index = reg.test(headArr.toLowerCase());				if(index){					arr.push(list[i]);					key.push(list[i]["MID"]);				}			}			if(key.length==0) break;			nList = nList.concat(arr);			headArr = key.join(",");			key.length = 0;			arr.length = 0;			h++;		}		return nList;	}};Menu.menuView = {		headList:function(list,nodeID,nodeText){		var menuView = new Array;		for( var i=0,len=list.length;i<len;i++ ){			menuView.push("<div class='accordionHeader' id='head_"+list[i][nodeID]+"'><h2><span>Folder</span>"+list[i][nodeText]+"</h2></div>");			menuView.push("<div class='accordionContent' id='menu_"+list[i][nodeID]+"'></div>");		}		return menuView;	},		mainHead:function(list,nodeID,nodeText){		var head = new Array;		head.push("<div id='navMenu'><ul>");		for( var i=0,len=list.length;i<len;i++ ){			head.push("<li><a href='javascript:void(0);' class='menuHead' setId='"+list[i][nodeID]+"'>"+list[i][nodeText]+"</a></li>");		}		head.push("</ul></div>");		return head;		},			menuList:function(list,projectName){		var menuView = new Array,url;		for( var i=0,len=list.length;i<len;i++ ){			if( !!list[i]["MUrl"] && list[i]["MUrl"].trim()!="..." ){				if(list[i]["MType"]=="F"){					menuView.push("<li id='menu_"+list[i]["MID"]+"' parentId='"+list[i]["ParentID"]+"'><a href='"+projectName+list[i]["MUrl"]+"' target='navTab' rel='external_"+list[i]["MID"]+"' external='true' >"+list[i]["MText"]+"</a></li>");				}else{					menuView.push("<li id='menu_"+list[i]["MID"]+"' parentId='"+list[i]["ParentID"]+"'><a href='"+projectName+list[i]["MUrl"]+"' target='navTab' rel='external_"+list[i]["MID"]+"' >"+list[i]["MText"]+"</a></li>");				}			}else{				if(list[i]["MType"]=="F"){					menuView.push("<li id='menu_"+list[i]["MID"]+"' parentId='"+list[i]["ParentID"]+"'><a href='"+projectName+list[i]["MUrl"]+"' target='navTab' rel='external_"+list[i]["MID"]+"' external='true' >"+list[i]["MText"]+"</a></li>");				}else{					menuView.push("<li id='menu_"+list[i]["MID"]+"' parentId='"+list[i]["ParentID"]+"'><a rel='external_"+list[i]["MID"]+"' >"+list[i]["MText"]+"</a></li>");				}			}		}		return menuView;	},		addUL:function( id,liView ){		var ulDom = getID("ul_"+id),menuDom = getID("menu_"+id);		if( ulDom === null ){			menuDom.innerHTML += "<ul id='ul_"+id+"'>"+liView+"</ul>";			var ulDom = getID("ul_"+id);			if( ulDom.parentNode.nodeName.toLowerCase() != "li" ){				ulDom.className = "tree treeFolder";			}		}else{			ulDom.innerHTML += liView;			}	},		otherView:function(){		var menuView;		menuView = "<div class='toggleCollapse'><h2>主菜单</h2><div onclick='newSideBarHide()'>主菜单</div></div><div class='accordion' fillSpace='sidebar' id='menuContent'></div>";		return menuView;	}};function newSideBarHide(){	var side=document.getElementById("sidebar");	var con=document.getElementById("container");	var split=document.getElementById("splitBar");	var side_s=document.getElementById("sidebar_s");	sidebar.style.display="none";	con.style.width="97.2%";	con.style.left="34px";	split.style.display="none";	side_s.style.display="block";	side_s.style.left="5px";}function setHeight(){	var j=0;	var parent = $("#sidebar");	for(var i=0,len=$(".accordionHeader", parent).size();i<len;i++){		$this = $(".accordionHeader", parent).eq(i);		if($this.css("display")!="none"){			j++;		}	};	var height = parent.height() - (j * ($(".accordionHeader:first-child", parent).outerHeight()));	$(".accordionContent",parent).height(height-$(".toggleCollapse:first-child").outerHeight()-3);}function menuDisplay(menuList,projectName){	var mv = Menu.menuView,md = Menu.menuDate,ml = menuList;	if( md.haveNode(ml,"menuHeader") && md.haveNode(ml,"menuList") && !md.isEmptyObject(ml) ){		var head = md.getList(menuList,"menuHeader"),			nH = new Array(),c,d,defaultDisplay,headArr,requireList			nMl = md.getList(ml,"menuList"),nM = new Array();		for( var n=0,hLen=head.length;n<hLen;n++ ){			if( head[n]["IsInToolbar"].toLowerCase()=="y" ){				nH.push(head[n]);			}		}		for(var j=0,jLen=nMl.length;j<jLen;j++){			if( nMl[j]["IsInToolbar"].toLowerCase()=="y" ){				nM.push(nMl[j]);			}		}		headArr = md.getNodeNameList(nH,"HID").join(",");		c = mv.headList(nH,"HID","HText").join("");		getID("sidebar").innerHTML += mv.otherView();		getID("menuContent").innerHTML = c;		d = mv.menuList( md.requireList( nM,headArr ),projectName );		for( var i=0,len=d.length;i<len;i++ ){			var id = d[i].match(/(.*)parentId='(.*)'><a(.*)/)[2];			mv.addUL( id,d[i] );		}				/*$(".accordionHeader").hide();		$(".accordionContent").hide();		defaultDisplay = md.getNode( head,"DefaultMenu" );		for( var i=0,len=defaultDisplay.length;i<len;i++ ){			$("#head_"+defaultDisplay[i]["HID"]).show();			$("#menu_"+defaultDisplay[i]["HID"]).show();		}		$(".menuHead").each(function(index){			$(this).click(function(){				var nodeId = $(this).attr("setId");					$(".accordionHeader").hide();				$(".accordionContent").hide();				$("#head_"+nodeId).click();				$("#head_"+nodeId).show();				$("#menu_"+nodeId).show();				setHeight();			});		});*/	}}function main(menuList,projectName){	var mv = Menu.menuView,md = Menu.menuDate;	if( md.haveNode(menuList,"menuHeader") && md.haveNode(menuList,"menuList") && !md.isEmptyObject(menuList) ){		//var head = md.getList(menuList,"menuHeader");		//var c = mv.mainHead(head,"HID","HText").join("");		//getID("header").innerHTML += c;		menuDisplay(menuList,projectName);	}	}